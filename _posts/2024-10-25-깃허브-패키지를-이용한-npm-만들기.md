---
layout: post
title: "íŒ€ Npm ë§Œë“¤ê¸°"
date: 2024-10-25 15:00:00 +0900
author: dhjeon
categories: npm github
published: true
---

<hr />

íŒ€ ë‚´ì—ì„œ envë¥¼ ì–´ë–»ê²Œ ê´€ë¦¬ë¥¼ í•´ì•¼í• ê¹Œ ë¼ëŠ” ê³ ë¯¼ì—ì„œ ì‹œì‘ë˜ì–´ npmì„ ë§Œë“¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ê¹ƒí—ˆë¸Œ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë³´ë©´ .env íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” í”„ë¡œì íŠ¸ë„ ìˆì§€ë§Œ ìµœê·¼ì— ìƒì„±ëœ í”„ë¡œì íŠ¸ë¥¼ ë³´ë©´ .env íŒŒì¼ì´ .gitignoreì— ì˜í•´ ì˜¬ë¼ê°€ì ¸ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì—‘ì…€ë¡œ ê³µìœ ë¥¼ í•œë‹¤ë˜ê°€ text íŒŒì¼ë¡œ ê³µìœ ë¥¼ í–ˆì—ˆëŠ”ë°ìš”.     

![ì—‘ì…€ ì‹œíŠ¸](/assets/images/dhjeon/241025/excel.png)

ì—¬ëŸ¬ ì‹œíŠ¸ ì•ˆì— í”„ë¡ íŠ¸, ë°±ì—”ë“œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì ì–´ ë†¨ì§€ë§Œ ì–´ë–¤ ë³€ìˆ˜ê°€ ë°”ë€ ê±´ì§€ ëˆ„ê°€ ë°”ê¾¼ ê±´ì§€ ì•Œê¸° ì–´ë µìŠµë‹ˆë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì— env ì •ë³´ì™€ ì¶”ê°€ì ìœ¼ë¡œ í•„ìš”í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ë©´ í˜„ì¬ ì–´ë–¤ envê°€ ìµœì‹  envì¸ì§€ ì•Œ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ í•´ì„œ DBì— ê´€ë ¨ ì •ë³´ë¥¼ ë„£ê³  íŒ€ì›ë“¤í•œí…Œ ì‰½ê²Œ ê³µìœ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ë‹¤ê°€ ì‚¬ë‚´ npmìœ¼ë¡œ ë§Œë“¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

### npm íŒŒì¼ ìƒì„±

npmì„ ë§Œë“¤ì–´ ë³¸ ì ì´ ì—†ê¸° ë•Œë¬¸ì— ì–´ë–»ê²Œ ì‹œì‘í•´ì•¼ í• ì§€ ë§‰ë§‰í–ˆëŠ”ë° ì•„ë˜ ë¸”ë¡œê·¸ì— ì •ë¦¬ê°€ ì˜ ë˜ì–´ìˆì—ˆìŠµë‹ˆë‹¤.

https://junghyeonsu.com/posts/deploy-simple-util-npm-library/

js â†’ ts ì „í™˜ê¹Œì§€ ë¸”ë¡œê·¸ë¥¼ ë”°ë¼í•˜ë©´ì„œ npm ì˜ ê¸°ì´ˆë¥¼ ë§Œë“¤ì–´ë‚˜ê°”ìŠµë‹ˆë‹¤.

(ì²˜ìŒì—” ë¬´ì‘ì • ë”°ë¼í•˜ê¸°ë§Œ í–ˆê¸° ë•Œë¬¸ì— íŒŒì¼ ìƒì„±ì—ì„œëŠ”â€¦. ë³„ë‹¤ë¥¸ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.. ğŸ˜“)

![ì—‘ì…€ ì‹œíŠ¸](/assets/images/dhjeon/241025/project.png)

```json
// package.json
{
  "name": "@pmi/env-manager",
  "version": "0.0.1",
  "main": "dist/index.js",
  "license": "MIT",
  "type": "module",
  "description": "npm deploy sample project",
  "author": "dhjeon",
  "private": false,
  "scripts": {
    "prepack": "npm run build",
    "build": "tsc",
    "publish": "npm publish"
  },
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./src/index.cjs",
      "types": "./dist/index.d.ts"
    }
  },
  "devDependencies": {
    "@types/node": "^22.7.9",
    "typescript": "^5.6.3"
  }
}
```

```typescript
// index.ts
async function fetchEnvAndCreateFile() {
  console.log('ë¡¸')
}

export { fetchEnvAndCreateFile }
```


## ë¡œì»¬ ê¸°ë°˜ Npm ë°°í¬ (Verdaccio)

ìœ„ì—ì„œ ë§Œë“  íŒŒì¼ì„ ì´ì œ ë°°í¬ë¥¼ í•´ì•¼ í•©ë‹ˆë‹¤.

npm ë°°í¬ë¥¼ ìƒê°í–ˆì„ ë•Œ ê°€ì¥ ë¨¼ì € ë– ì˜¤ë¥¸ ì‚¬ì´íŠ¸ëŠ” ë‹¹ì—°íˆ Npm ê³µì‹ í™ˆí˜ì´ì§€ì˜€ìŠµë‹ˆë‹¤.

[Npm ê³µì‹ í™ˆí˜ì´ì§€](https://www.npmjs.com/)

ê³µì‹ í™ˆí˜ì´ì§€ì— ë°°í¬ í• ë ¤ê³  ë³´ë‹ˆ Private npmì„ ì˜¬ë¦¬ê¸° ìœ„í•´ì„œëŠ” ìœ ë£Œë¡œ ì „í™˜ì„ í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì‚¬ë‚´ ì„œë²„ì— npmì„ ì˜¬ë ¤ì„œ ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ ë¼ëŠ” ìƒê°ì— ê´€ë ¨í•´ì„œ ì°¾ì•„ë³´ë‹ˆê¹Œ **verdaccio** ë¼ëŠ” local ê¸°ë°˜ npm tool ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

[Npm Verdaccio](https://www.npmjs.com/package/verdaccio)


ì‚¬ìš©ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. ì¸ìŠ¤í†¨ í›„ ì»¤ë§¨ë“œ ì‹¤í–‰

```bash
# npm install
npm i -g verdaccio

# server start
verdaccio 
```

![Verdaccio start](/assets/images/dhjeon/241025/cli1.png)

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ 4873 í¬íŠ¸ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.

package.jsonì—ì„œ í¼ë¸”ë¦¬ì‹± ë¶€ë¶„ì„ ì´ì œ ì € npm ì„œë²„ë¥¼ ë°”ë¼ë³´ê²Œí•´ì„œ í¼ë¸”ë¦¬ì‹± í•˜ë©´ ë

ì‚¬ìš©ë²•ë„ ê°„ë‹¨í–ˆê³  ìœ„ íˆ´ì„ ë„ì»¤ ì»¨í…Œì´ë„ˆì— ë„ì›Œì„œ í¬íŠ¸ë§Œ ë§ì¶°ì£¼ë©´ ë˜ì§€ ì•Šì„ê¹Œ ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

```json
{
  "name": "@pmi/env-manager",
  "version": "0.0.19",
  "main": "dist/app.js",
  "license": "MIT",
  "type": "commonjs",
  "description": "npm deploy sample project",
  "author": "dhjeon",
  "private": false,
  "scripts": {
    "start": "ts-node ./dist/app.js",
    "publish": "npm publish --registry http://localhost:4873/",
    "unpublish": "npm unpublish @pmi/env-manager --force --registry http://localhost:4873/",
    "view": "npm view @pmi/env-manager --registry http://localhost:4873/"
  },
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./src/index.cjs",
      "types": "./dist/index.d.ts"
    }
  }
}
```

![Verdaccio dashboard](/assets/images/dhjeon/241025/ver.png)

ë¡œì»¬ì— ë°°í¬í•œ npmì„ ë‹¤ìš´ë°›ê¸° ìœ„í•´ì„œëŠ” npm ì €ì¥ì†Œë¥¼ ë³€ê²½í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

```bash
# @pmi/env-manager íŒ¨í‚¤ì§€ë¥¼ http://localhost:4873 ì—ì„œ ê°€ì ¸ì˜¨ë‹¤.
npm install @pmi/env-manager --registry=http://localhost:4873

## ë§¤ ë²ˆ ì €ì¥ì†Œ ì£¼ì†Œë¥¼ ì¹˜ê¸° ê·€ì°®ìœ¼ë‹ˆê¹Œ @pmië¡œ ì‹œì‘ë˜ëŠ” íŒ¨í‚¤ì§€ëŠ” í•­ìƒ ì•„ë˜ ì €ì¥ì†Œì—ì„œ ê°€ì ¸ì˜¤ë„ë¡
npm set @pmi:registry http://localhost:4873
```

## ê¹ƒí—ˆë¸Œ íŒ¨í‚¤ì§€ ë°°í¬

verdaccio ë¡œ ì‘ì—…ì„ í•´ë‘ê³  ë¶€ì¥ë‹˜ê»˜ npm ì„œë²„ë¥¼ ë§Œë“¤ì–´ ë‹¬ë¼ê³  ë§ì”€ë“œë¦¬ë ¤ëŠ” ì°°ë‚˜ì— **ê¹ƒí—ˆë¸Œ íŒ¨í‚¤ì§€ë¥¼ í†µí•˜ì—¬ npmì„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤**ë¼ëŠ” ê¸€ì„ ë´¤ìŠµë‹ˆë‹¤.

ê¹ƒí—ˆë¸Œë¥¼ í™œìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ê¸° ë•Œë¬¸ì— ì´ ë°©ë²•ì´ ë” ì¢‹ì€ ê²ƒ ê°™ì•„ ë°°í¬ ë°©ì‹ì„ ë³€ê²½í•´ë´…ë‹ˆë‹¤.

ì£¼ìš”í•˜ê²Œ ë³´ì•„ì•¼ í•  ì˜µì…˜ì€ **`publishConfig`** **`repository`** **`scripts`** ì„¸ ì˜µì…˜ ì…ë‹ˆë‹¤.

ì´ì œ **ë¡œì»¬ ì €ì¥ì†Œê°€ ì•„ë‹Œ ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œë¥¼ ë°”ë¼ë³´ë„ë¡** í•´ì•¼ í•˜ê³  ì €í¬ íŒŒì¼ì„ ì €ì¥í•  ë ˆí¬ì§€í† ë¦¬ë„ ìƒì„±í•´ ì¤˜ì•¼ í•©ë‹ˆë‹¤.

```json
{
  "name": "@pmi/env-manager",
  "version": "0.1.4",
  "main": "dist/app.js",
  "license": "MIT",
  "type": "commonjs",
  "description": "PMI Env manager",
  "author": "dhjeon",
  "private": false,
  "publishConfig": {
    "registry": "https://npm.pkg.github.com/"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/pmirnc-dev/npm-packages.git"
  },
  "scripts": {
    "prepare": "tsc",
    "start": "ts-node ./dist/app.js",
    "start:dev": "ts-node ./src/app.ts",
    "publish": "npm publish --registry=https://npm.pkg.github.com",
    "unpublish": "npm unpublish @pmi/env-manager --force --registry=https://npm.pkg.github.com",
    "view": "npm view @pmi/env-manager --registry=https://npm.pkg.github.com"
  },
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./src/index.cjs",
      "types": "./dist/index.d.ts"
    }
  },
  "devDependencies": {
  },
  "dependencies": {
   }
}
```

ê¹ƒí—ˆë¸Œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ https://npm.pkg.github.com/
        
ê¹ƒí—ˆë¸Œë¡œ ë°°í¬ ìœ„ì¹˜ë¥¼ ë³€ê²½í•´ì¤¬ìœ¼ë‹ˆ ë¡œê·¸ì¸ ë° í¼ë¸”ë¦¬ì‹±ì„ í•´ì¤ë‹ˆë‹¤.


```bash
## ê¹ƒí—ˆë¸Œ NPM ë¡œê·¸ì¸
npm login --scope=@pmi --registry=https://npm.pkg.github.com

## ê¹ƒí—ˆë¸Œì— ë“±ë¡ëœ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ex hsyoo, dhjeon ...)
> username : 
## ìœ„ì— ì…ë ¥í•œ ê³„ì •ì˜ í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
> password : 
## ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
> email : 

## í¼ë¸”ë¦¬ì‹±
npm publish
```

ê·¸ëŸ¬ë©´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤. ğŸ˜¡ (404 Not Found)        

package.jsonì˜ nameì„ í™•ì¸í•´ ë³´ë©´ **"@pmi/env-manager"** ë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.

ë¡œì»¬ì—ì„œëŠ” ì–´ë–¤ ì´ë¦„ì„ ì‘ì„±í•˜ë˜ ìƒê´€ì´ ì—†ì—ˆëŠ”ë° ê¹ƒí—ˆë¸Œì— ì˜¬ë¦¬ê¸° ìœ„í•´ì„œëŠ” Scopeë¥¼ ì˜ ì…ë ¥í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

**@ ë’¤ / ì•ì— ìœ„ì¹˜í•œ ê°’ì´ Scope**ì´ê³  ì´ ScopeëŠ” **ë³¸ì¸ì˜ ê¹ƒí—ˆë¸Œ ê³„ì • ì´ë¦„ì´ê±°ë‚˜ ì¡°ì§ ì´ë¦„**ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ì €í¬ íŒ€ ì¡°ì§ ì´ë¦„ì€ **pmirnc-dev** ì…ë‹ˆë‹¤.


```json
{
  "name": "@pmirnc-dev/env-manager",
  "version": "0.1.4",
  "main": "dist/app.js",
  "license": "MIT",
  "type": "commonjs",
  "description": "PMI Env manager",
  "author": "dhjeon",
  "private": false,
  "publishConfig": {
    "registry": "https://npm.pkg.github.com/"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/pmirnc-dev/npm-packages.git"
  },
  "scripts": {
    "prepare": "tsc",
    "start": "ts-node ./dist/app.js",
    "start:dev": "ts-node ./src/app.ts",
    "publish": "npm publish --registry=https://npm.pkg.github.com",
    "unpublish": "npm unpublish @pmirnc-dev/env-manager --force --registry=https://npm.pkg.github.com",
    "view": "npm view @pmirnc-dev/env-manager --registry=https://npm.pkg.github.com"
  },
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./src/index.cjs",
      "types": "./dist/index.d.ts"
    }
  },
  "devDependencies": {
  },
  "dependencies": {
   }
}
```

ì´ë¦„ì„ ë³€ê²½í•´ì£¼ê³  **`npm publish`** ë¥¼ í•´ì¤ë‹ˆë‹¤. 

![npm1](/assets/images/dhjeon/241025/img1.png)

![npm2](/assets/images/dhjeon/241025/img2.png)

ì„±ê³µí–ˆìœ¼ë©´ ë ˆí¬ì§€í† ë¦¬ì— ìœ„ì™€ ê°™ì€ ì •ë³´ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.

(íƒœì´ˆ ë²„ì „ì˜ ì´ë¯¸ì§€ëŠ” ì—†ìŠµë‹ˆë‹¤... ë²„ì „ì€ ì‹ ê²½ì“°ì§€ ë§ì•„ì£¼ì„¸ìš”.ğŸ˜­)

ì•„ë¬´íŠ¼ ë°°í¬ ë° ì„¤ì¹˜ì— ì„±ê³µì„ í–ˆìœ¼ë‹ˆê¹Œ ì´ì œ ë‚´ë¶€ í•¨ìˆ˜ë¥¼ ì±„ì›Œì¤ë‹ˆë‹¤.

## CLIë¡œ ì‹¤í–‰ì‹œí‚¤ê¸°

```typescript
const httpClient = require("./lib/httpClient");
const fs = require('fs');
const path = require('path');

async function fetchEnvAndCreateFile(project: string, deploy: string, type: string): Promise<void> {
  if (!project)
    throw new Error('í”„ë¡œì íŠ¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');

  if (!deploy)
    throw new Error('ë°°í¬ í™˜ê²½ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.')
  try {

    const fileName = `.env.${deploy}`;
    // .env-test íŒŒì¼ ê²½ë¡œ
    const envFilePath = path.join(__dirname, `../${fileName}`);
    if (!envFilePath)
      throw new Error('íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');

    // íŒŒì¼ ì½ê¸°
    const envContent = fs.readFileSync(envFilePath, 'utf-8');
    const envContentSplit = envContent.split('\n')
    const environments = envContentSplit.map((v: string) => {
      const [key, value] = v.split('=');
      return {
        key: key.trim(),
        value: value ? value.trim() : ''
      };
    })

    const response = await httpClient.post(`http://localhost:4000/api/env?project=${project}&deploy=${deploy}&type=${type}`, {
      environments
    });
    console.log(response.data);
  } catch (error) {
    console.error(error);
  }
}

export { fetchEnvAndCreateFile }
```

ê·¼ë° ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. í•¨ìˆ˜ íŒŒë¼ë¯¸í„°ë¥¼ ë³´ë©´ `project` `deploy` `type` 3 ê°œì˜ íŒŒë¼ë¯¸í„° ê°’ì„ ë°›ë„ë¡ ë˜ì–´ìˆëŠ”ë° ì´ê±¸ ì‹¤í–‰í•˜ëŠ” ê³³ì—ì„œ ì–´ë–»ê²Œ ì „ë‹¬ì„ í•´ì•¼ í•˜ëŠ”ì§€ ì˜ë¬¸ì´ ë“­ë‹ˆë‹¤.

ë˜í•œ ë¬´ì¡°ê±´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ë° ê·¸ë ‡ë‹¤ëŠ” ê±´ ì„œë²„ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— í˜¹ì€ ë¹Œë“œë¥¼ í•˜ê¸° ì „ì— í•­ìƒ ì € í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë˜ì•¼ env íŒŒì¼ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆê¹Œìš”.

ìš°ì„  ì˜ì‹ì˜ íë¦„ëŒ€ë¡œ scriptsë¥¼ í†µí•´ 3 ê°œì˜ íŒŒë¼ë¯¸í„° ê°’ì„ ë°›ì•„ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ë¡œì»¬ì—ì„œ ë¨¼ì € ì‘ì—…í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.

```typescript
// generate-env.ts (ë¡œì»¬ íŒŒì¼)
const httpClient = require("./lib/httpClient");
const fs = require('fs');
const path = require('path');

async function fetchEnvAndCreateFile(project: string, deploy: string, type: string): Promise<void> {
  if (!project)
    throw new Error('í”„ë¡œì íŠ¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');

  if (!deploy)
    throw new Error('ë°°í¬ í™˜ê²½ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.')
  try {

    const fileName = `.env.${deploy}`;
    // .env-test íŒŒì¼ ê²½ë¡œ
    const envFilePath = path.join(__dirname, `../${fileName}`);
    if (!envFilePath)
      throw new Error('íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');

    // íŒŒì¼ ì½ê¸°
    const envContent = fs.readFileSync(envFilePath, 'utf-8');
    const envContentSplit = envContent.split('\n')
    const environments = envContentSplit.map((v: string) => {
      const [key, value] = v.split('=');
      return {
        key: key.trim(),
        value: value ? value.trim() : ''
      };
    })

    const response = await httpClient.post(`http://localhost:4000/api/env?project=${project}&deploy=${deploy}&type=${type}`, {
      environments
    });
    console.log(response.data);
  } catch (error) {
    console.error(error);
  }
}

const [,, project, deploy, type] = process.argv;
fetchEnvAndCreateFile(project, deploy, type);
```

```json
{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "generate-env": "ts-node ./src/generate-env.ts unisurvey development fe"
  },
  "dependencies": {
    "@pmi/env-manager": "0.0.19"
  }
}
```

**`process.argv`** ì„ ì‚¬ìš©í•˜ë©´ node.js í™˜ê²½ì—ì„œ ì „ë‹¬ëœ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì½ì–´ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ ì € ìˆœì„œì— ë§ì¶°ì„œ
- project: unisurvey
- deploy: development
- type: fe

ë„£ì–´ì£¼ê³  scriptë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ í•´ë‹¹ íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ í˜„ì¬ì˜ ë°©ì‹ì—ì„œëŠ” í”„ë¡œì íŠ¸ ë‚´ì— ì¶”ê°€ì ìœ¼ë¡œ íŒŒì¼ì„ ìƒì„±í•´ì£¼ê³  íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬ì„ í•´ì•¼ë§Œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆëŠ”ë°ìš”.

ê·¸ë˜ì„œ ë‹¤ìŒìœ¼ë¡œ ìƒê°í•œ ê±´ ì €í¬ê°€ í¬ë¡¤ë§ì„ í•  ë•Œ app íŒŒì¼ì„ ë§Œë“¤ê³  ì´ íŒŒì¼ì„ ì‹¤í–‰ì‹œì¼œ í¬ë¡¤ëŸ¬ë¥¼ ë„ì› ìŠµë‹ˆë‹¤. ì´ê²ƒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ CLIë¥¼ í†µí•˜ì—¬ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œë¼ëŠ” ìƒê°ìœ¼ë¡œ ì ‘ê·¼í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.

app.ts íŒŒì¼ì„ ìƒì„±í•˜ê³  ê±°ê¸°ì„œ ìœ„ì—ì„œ ë§Œë“  í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì¤ë‹ˆë‹¤.

```typescript
#!/usr/bin/env node

// app.ts
import {fetchEnvAndCreateFile, fetchEnvAndGetFile} from "./index";

const [,, project, deploy, type, command] = process.argv;

async function main() {
  try {
    if (!project || !deploy || !type) {
      throw new Error('í”„ë¡œì íŠ¸, ë°°í¬ í™˜ê²½, íƒ€ì…ì„ ëª¨ë‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
    }

    if (command === 'create') {
      await fetchEnvAndCreateFile(project, deploy, type);
      console.log('Env file created successfully.');
    } else if (command === 'get') {
      await fetchEnvAndGetFile(project, deploy, type);
      console.log('Env file retrieved successfully.');
    } else {
      throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ íƒ€ì…ì…ë‹ˆë‹¤. "create" ë˜ëŠ” "get"ì„ ì‚¬ìš©í•˜ì„¸ìš”.');
    }
  } catch (error) {
    console.error('Error:', error.message);
  }
}

main();
```

ìŠ¤í¬ë¦½íŠ¸ë¡œ app.tsë¥¼ ì‹¤í–‰ì„ í•´ì•¼í•˜ëŠ”ë° npmì„ ìƒì„±í•  ë•Œ CLIì—ì„œ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” **bin ì´ë¼ëŠ” ì˜µì…˜**ì´ ìˆìŠµë‹ˆë‹¤.

```json
{
  // ...pacakage.json ë‚´ìš© ìƒëµ
  "bin": {
    "env-manager": "./dist/app.js"
  }
}
```

bin ì˜µì…˜ì„ ì£¼ê²Œ ë˜ë©´ node_modules ë‚´ì˜ bin íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

![node_modules](/assets/images/dhjeon/241025/img3.png)

binì— ì‹¤í–‰ì‹œí‚¬ íŒŒì¼ì„ ë“±ë¡í•´ì£¼ë©´ **`npx ~~~`** ë¥¼ í†µí•˜ì—¬ í•´ë‹¹ íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
npx @pmi/env-manger unisurvey development fe create
```

ì´ì œ npmì„ ë‹¤ìš´ ë°›ì€ í”„ë¡œì íŠ¸ì—ì„œ ì¶”ê°€ì ìœ¼ë¡œ íŒŒì¼ ìƒì„± í•„ìš” ì—†ì´ npx ëª…ë ¹ì–´ë¥¼ í†µí•˜ì—¬ app.tsë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ íŒŒë¼ë¯¸í„° ê°’ì´ 4ê°œë¡œ ëŠ˜ì–´ë‚¬ëŠ”ë° ì´ê±¸ ìˆœì„œì— ë§ì¶°ì„œ í•˜ë‚˜ì”© íƒ€ì´í•‘ì„ í•´ì¤˜ì•¼ í•˜ëŠ”ë° ë¶ˆí¸í•©ë‹ˆë‹¤. 

ì˜¤íƒ€ê°€ ë°œìƒí•  ìˆ˜ë„ ìˆê³  ì €ë„ ì‘ì—…í•˜ë©´ì„œ ìˆœì„œ í—·ê°ˆë ¤ì„œ ì½”ë“œ ë³´ë©´ì„œ í–ˆëŠ”ë° ë‹¤ë¥¸ íŒ€ì›ë“¤ì€ ë” í—·ê°ˆë¦´ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì¢€ ë” ë¨¸ë¦¬ë¥¼ êµ´ë ¤ë´…ë‹ˆë‹¤.

![img5](/assets/images/dhjeon/241025/img5.gif)

ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ë‹¤ìš´ ë°›ì„ ë•Œ í•­ìƒ í•˜ëŠ” ì‘ì—…ì´ í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ë˜ê°€, í”„ë¡œì íŠ¸ì— ì‚¬ìš©í•  ì˜µì…˜ì„ ì„ íƒí•˜ë˜ê°€ í•˜ëŠ” ì—¬ëŸ¬ ì„ ì§€ê°€ ì£¼ì–´ì¡Œì—ˆëŠ”ë° ê·¸ê±¸ í™œìš©í•´ë³¼ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ ë¼ëŠ” ìƒê°ì´ ë“¤ì–´ ì°¾ì•„ë³´ëŠ”ë° ì—­ì‹œ ìˆìŠµë‹ˆë‹¤.

## í”„ë¡¬í”„íŠ¸ ë§Œë“¤ê¸°

[Npm prompt](https://www.npmjs.com/package/prompt)

í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì‚¬ìš©ìê°€ ì‘ì„±ëœ ê°’ ê¸°ì¤€ìœ¼ë¡œ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤.

```typescript
// index.ts
const {AxiosError} = require('axios');
const httpClient = require('./lib/httpClient');
const fs = require('fs');
const path = require('path');
const inquirer = require('inquirer').default;

type ErrorType = typeof AxiosError;

enum FileType {
  ETC = 'Etc'
}

/**
 * @description env íŒŒì¼ ë“±ë¡
 */
export async function fetchEnvAndCreateFile(): Promise<void> {
  inquirer.prompt([{
    name: 'project',
    type: 'input',
    message: 'í”„ë¡œì íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (github repository)',
    validate: (input: string) => input ? true : 'í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤!',
    required: true,
  },
    {
    name: 'fileName',
    type: 'list',
    message: 'íŒŒì¼ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.',
    choices: ['.env.development', '.env.staging', '.env.production', FileType.ETC],
    default: '.env.development',
    required: true,
  },
    {
      name: 'customFileName',
      type: 'input',
      message: 'íŒŒì¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:',
      when: (answers: any) => answers.fileName === FileType.ETC,
      validate: (input) => input ? true : 'íŒŒì¼ëª…ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤!',
    },
    {
    name: 'type',
    type: 'list',
    message: 'ì„œë²„ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.',
    choices: ['í”„ë¡ íŠ¸ì—”ë“œ', 'ë°±ì—”ë“œ'],
    required: true,
  },{
    name: 'username',
    type: 'input',
    message: 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì´ ì •ë³´ëŠ” íˆìŠ¤í† ë¦¬ ìš©ë„ë¡œ ì €ì¥ë©ë‹ˆë‹¤)',
    required: true,
  }]).then(async (answer: any) => {
    const {project, fileName, type, username, customFileName} = answer;

    let name = fileName;

    if (fileName === FileType.ETC) {
      name = customFileName;
    }

    try {
      const envFilePath = path.join(process.cwd(), `${name}`);
      if (!envFilePath)
        throw new Error('íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      // íŒŒì¼ ì½ê¸°
      const envContent = fs.readFileSync(envFilePath, 'utf-8');
      const envContentSplit = envContent.split('\n')
      const environments = envContentSplit.map((v: string) => {
        const [key, value] = v.split('=');
        return {
          key: key.trim(),
          value: value ? value.trim() : ''
        };
      }).filter(env => env.key !== '');

      const body = {
        project,
        fileName: name,
        type,
        username,
        environments
      }

      const response = await httpClient.post(`/env/upload`, body);
      console.log('Env file content sent successfully:', response.data);
    } catch (e) {
      console.error('ğŸš¨ íŒŒì¼ ë“±ë¡ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
      const axiosError = e as unknown as ErrorType;
      if (axiosError.response) {
        const { status, data } = axiosError.response;
        console.log(`âŒ ì„œë²„ ì—ëŸ¬ [ìƒíƒœ ì½”ë“œ: ${status}]: ${data.message}`);
      } else if (e instanceof Error) {
        console.log(`ğŸ’¥ ì˜ˆê¸°ì¹˜ ëª»í•œ ì˜¤ë¥˜ ë°œìƒ: ${e.message}`);
        console.log(e)
      } else {
        console.log('ğŸ› ï¸ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜:', e);
      }
    }
  });
}

/**
 * @description env íŒŒì¼ ë‹¤ìš´ë¡œë“œ
 */
export async function fetchEnvAndGetFile(): Promise<void> {
  inquirer.prompt([{
    name: 'project',
    type: 'input',
    message: 'í”„ë¡œì íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (github repository)',
    validate: (input: string) => input ? true : 'í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤!',
    required: true,
  },{
    name: 'fileNames',
    type: 'checkbox',
    message: 'íŒŒì¼ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.',
    choices: ['.env.development', '.env.staging', '.env.production', FileType.ETC],
    required: true,
  },
    {
      name: 'customFileName',
      type: 'input',
      message: 'íŒŒì¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:',
      when: (answers: any) => answers.fileNames.includes(FileType.ETC),
      validate: (input) => input ? true : 'íŒŒì¼ëª…ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤!',
    },
    {
    name: 'type',
    type: 'list',
    message: 'ì„œë²„ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.',
    choices: ['í”„ë¡ íŠ¸ì—”ë“œ', 'ë°±ì—”ë“œ'],
    required: true,
  },{
    name: 'username',
    type: 'input',
    message: 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì´ ì •ë³´ëŠ” íˆìŠ¤í† ë¦¬ ìš©ë„ë¡œ ì €ì¥ë©ë‹ˆë‹¤)',
    required: true,
  }]).then(async (answer: any) => {
    const {project, fileNames, type, username, customFileName} = answer;

    const names = fileNames.map((name: string) => {
      if (name === FileType.ETC) return customFileName;
      else return name;
    });

    try {
      const body = {
        project,
        fileNames: names,
        type,
        username
      }
      const response = await httpClient.post(`/env/download`, body);
      const envVariables = response.data;
      if (!envVariables)
        throw new Error('íŒŒì¼ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');

      envVariables.map((v) => {
        const {fileName, environments} = v;
        const envContent = environments.map((env: {key: string, value: string}) => {
          const {key, value} = env;
          return value ? `${key}=${value}` : key;
        }).join('\n');
        fs.writeFileSync(path.join(process.cwd(), `${fileName}`), envContent);
      })
    } catch (e) {
      console.error('ğŸš¨ íŒŒì¼ ìƒì„±ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
      const axiosError = e as unknown as ErrorType;
      if (axiosError.response) {
        const { status, data } = axiosError.response;
        console.log(`âŒ ì„œë²„ ì—ëŸ¬ [ìƒíƒœ ì½”ë“œ: ${status}]: ${data.message}`);
      } else if (e instanceof Error) {
        console.log(`ğŸ’¥ ì˜ˆê¸°ì¹˜ ëª»í•œ ì˜¤ë¥˜ ë°œìƒ: ${e.message}`);
        console.log(e)
      } else {
        console.log('ğŸ› ï¸ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜:', e);
      }
    }
  })
}
```

í”„ë¡¬í”„íŠ¸ë¥¼ í†µí•˜ì—¬ ê°’ì„ ì…ë ¥ ë°›ê¸° ë•Œë¬¸ì— ëª…ë ¹ì–´ë¥¼ í†µí•˜ì—¬ ìœ„ appë§Œ ì‹¤í–‰ì‹œì¼œì£¼ë©´ ëì…ë‹ˆë‹¤.

![done](/assets/images/dhjeon/241025/dpme.png)

ì´ë ‡ê²Œ ì²« npm ë§Œë“¤ê¸°ê°€ ëì´ ë‚¬ìŠµë‹ˆë‹¤.

ì¢€ ë” ë‹¤ë“¬ì–´ì•¼í•  ë¶€ë¶„ì´ ë§ì§€ë§Œ ì˜ í™œìš©ëìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.

[README](https://github.com/pmirnc-dev/npm-packages/pkgs/npm/env-manager/294966828)